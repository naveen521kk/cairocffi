name: Build Wheels

on:
  push:


jobs:
  build:

    runs-on: windows-latest

    steps:
    - uses: actions/checkout@v2
    - name: Set up Python 3.8
      uses: actions/setup-python@v2
      with:
        python-version: 3.8
    - name: Install dependencies
      run: |
        python -m pip install --upgrade pip

    - name: Download Cairo
      run: |
        curl -L https://github.com/preshing/cairo-windows/releases/download/with-tee/cairo-windows-1.17.2.zip -o cairo-windows.zip
        7z x cairo-windows.zip
        Move-Item 'cairo-windows-*' "cairocomplied"
        Copy-Item "$PWD\cairocomplied\lib\x64\cairo.dll" "cairocffi\cairo.dll"
    - name: Test
      run: |
        $env:INCLUDE="$PWD\cairocomplied\include\"
        $env:LIB="$PWD\cairocomplied\lib\x64\"
        python setup.py install
        python setup.py bdist_wheel
        python setup.py test
    - uses: actions/upload-artifact@v2
      with:
         name: wheels-${{ matrix.python-version }}
         path: dist/pycairo*.whl   
